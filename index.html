<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³°æ–‡å–®å­—å¡ - ç¯©é¸å„ªåŒ–ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --primary: #ff6b6b; --bg: #f8f9fa; --text: #2d3436; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .filter-container { 
            background: white; padding: 15px 25px; border-radius: 50px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 30px;
            display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;
            position: sticky; top: 10px; z-index: 100;
        }
        
        select { 
            padding: 8px 15px; border-radius: 20px; border: 1px solid #ddd; 
            outline: none; font-size: 0.9em; cursor: pointer; background: #fff;
        }

        #card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; width: 100%; max-width: 1200px; }
        
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 8px 15px rgba(0,0,0,0.05); text-align: center; cursor: pointer; transition: 0.2s; position: relative; border: 2px solid transparent; -webkit-tap-highlight-color: transparent; }
        .card:active { transform: scale(0.96); background-color: #fffafa; }
        .card.playing { border-color: var(--primary); box-shadow: 0 0 15px rgba(255,107,107,0.2); }
        
        .lesson-tag { position: absolute; top: 15px; left: 15px; background: #ffeaa7; color: #d63031; padding: 2px 10px; border-radius: 12px; font-size: 0.8em; font-weight: bold; }
        .type-tag { position: absolute; top: 15px; right: 15px; color: #b2bec3; font-size: 0.8em; font-weight: bold; }
        
        .thai-word { font-size: 2.8em; margin: 15px 0 5px 0; color: var(--text); font-weight: 600; }
        .word-class { font-size: 0.9em; color: var(--primary); margin-bottom: 10px; font-style: italic; }
        .chinese-define { font-size: 1.3em; color: #636e72; }
        
        .loading { margin-top: 100px; color: #999; }
    </style>
</head>
<body>

    <h1>ğŸ‡¹ğŸ‡­ æ³°æ–‡å–®å­—ç·´ç¿’</h1>

    <div class="filter-container">
        <select id="filter-lesson"><option value="">æ‰€æœ‰èª²ç¨‹ (Lesson)</option></select>
        <select id="filter-type"><option value="">æ‰€æœ‰é¡å‹ (Type)</option></select>
        <select id="filter-class"><option value="">æ‰€æœ‰è©æ€§ (Class)</option></select>
    </div>

    <div id="card-container" class="loading">æ­£åœ¨è¼‰å…¥å–®å­—åº«...</div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSHyMhwwJ12txyfcuAao1MsSR2K2WM61nYGqmSs-ub4Nm8BXmSGtF8h2tOXGJpqIhgLeBV35Im6C8ua/pub?gid=0&single=true&output=csv';
        let allWords = [];
        const audioPlayer = new Audio();

        function init() {
            Papa.parse(CSV_URL, {
                download: true,
                header: true, 
                skipEmptyLines: true,
                complete: function(results) {
                    allWords = results.data.filter(item => item.word);
                    setupFilters();
                    renderCards(allWords);
                }
            });
        }

        function setupFilters() {
            const lessons = [...new Set(allWords.map(i => i.lesson))].sort();
            const types = [...new Set(allWords.map(i => i.type))].sort();
            const classes = [...new Set(allWords.map(i => i.class))].sort();

            fillSelect('filter-lesson', lessons);
            fillSelect('filter-type', types);
            fillSelect('filter-class', classes);

            // ç¶å®šç›£è½äº‹ä»¶
            [ 'filter-lesson', 'filter-type', 'filter-class' ].forEach(id => {
                document.getElementById(id).addEventListener('change', performFilter);
            });
        }

        function fillSelect(id, items) {
            const select = document.getElementById(id);
            items.forEach(item => {
                if(!item) return;
                const opt = document.createElement('option');
                opt.value = item;
                opt.textContent = item;
                select.appendChild(opt);
            });
        }

        function performFilter() {
            const l = document.getElementById('filter-lesson').value;
            const t = document.getElementById('filter-type').value;
            const c = document.getElementById('filter-class').value;

            const filtered = allWords.filter(item => {
                return (l === '' || item.lesson === l) &&
                       (t === '' || item.type === t) &&
                       (c === '' || item.class === c);
            });
            renderCards(filtered);
        }

        function renderCards(words) {
            const container = document.getElementById('card-container');
            container.innerHTML = '';
            container.classList.remove('loading');

            words.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                const hasAudio = item.audioURL && item.audioURL.trim() !== "";

                card.onclick = () => {
                    if (hasAudio) {
                        document.querySelectorAll('.card').forEach(c => c.classList.remove('playing'));
                        card.classList.add('playing');
                        audioPlayer.src = item.audioURL;
                        audioPlayer.play().catch(e => console.log("Play blocked"));
                    }
                };

                card.innerHTML = `
                    <div class="lesson-tag">L${item.lesson || '?'}</div>
                    <div class="type-tag">${item.type || ''}</div>
                    <div class="thai-word">${item.word}</div>
                    <div class="word-class">${item.class ? '[ ' + item.class + ' ]' : ''}</div>
                    <div class="chinese-define">${item.define}</div>
                    <div style="margin-top:10px; opacity: ${hasAudio ? 1 : 0.1}">ğŸ”Š</div>
                `;
                container.appendChild(card);
            });
        }

        init();
    </script>
</body>
</html>